<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VisionCharts Demo</title>
  <style>
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background-color: #f9f9f9;
    }
    
    header {
      margin-bottom: 40px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    
    h1 {
      color: #1468a8;
    }
    
    .chart-container {
      height: 400px;
      margin-bottom: 40px;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      background-color: #fff;
      position: relative; /* Added for error messages */
    }
    
    .controls {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    label {
      font-weight: 600;
      font-size: 14px;
    }
    
    button {
      padding: 8px 16px;
      background-color: #1468a8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #0d5082;
    }

    button.active {
      background-color: #34A853;
    }
    
    select, input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      min-width: 120px;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 30px;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid transparent;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      margin-right: 5px;
      background-color: #f5f5f5;
      transition: background-color 0.2s;
    }
    
    .tab.active {
      background-color: #fff;
      border-color: #ddd;
      position: relative;
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 1px;
      background-color: #fff;
    }

    .tab:hover {
      background-color: #e9e9e9;
    }

    .tab.active:hover {
      background-color: #fff;
    }

    footer {
      margin-top: 60px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      text-align: center;
      color: #666;
    }
    
    /* Error message styling */
    .error-message {
      color: #d32f2f;
      background-color: #ffebee;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
      border-left: 4px solid #d32f2f;
      font-size: 14px;
    }
    
    .debug-info {
      margin-top: 10px;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <header>
    <h1>VisionCharts Demo</h1>
    <p>A modern, high-performance JavaScript charting library optimized for financial and economic data visualization.</p>
  </header>
  
  <div id="debug-output" class="debug-info" style="display: none;"></div>
  
  <div class="tabs">
    <div class="tab active" data-tab="line">Line Chart</div>
    <div class="tab" data-tab="area">Area Chart</div>
    <div class="tab" data-tab="bar">Bar Chart</div>
  </div>
  
  <main>
    <!-- Line Chart Section -->
    <section id="line-section" class="chart-section">
      <h2>Line Chart</h2>
      <div class="controls">
        <div class="control-group">
          <label for="line-curve">Curve Type</label>
          <select id="line-curve">
            <option value="linear">Linear</option>
            <option value="step">Step</option>
            <option value="cardinal">Cardinal</option>
            <option value="monotone" selected>Monotone</option>
          </select>
        </div>
        <div class="control-group">
          <label for="line-x-name">X Axis Name</label>
          <input type="text" id="line-x-name" value="Date" placeholder="X Axis Name">
        </div>
        <div class="control-group">
          <label for="line-y-name">Y Axis Name</label>
          <input type="text" id="line-y-name" value="Price ($)" placeholder="Y Axis Name">
        </div>
        <div class="control-group">
          <button id="line-toggle-log" class="toggle-button">Toggle Logarithmic</button>
        </div>
        <div class="control-group">
          <button id="line-toggle-panel" class="toggle-button">Toggle Panel View</button>
        </div>
        <div class="control-group">
          <button id="line-toggle-recession" class="toggle-button">Toggle Recessions</button>
        </div>
        <div class="control-group">
          <button id="line-toggle-zero" class="toggle-button">Toggle Zero Line</button>
        </div>
        <div class="control-group">
          <button id="line-toggle-area" class="toggle-button">Toggle Area</button>
        </div>
      </div>
      <div id="line-chart" class="chart-container"></div>
    </section>
    
    <!-- Area Chart Section -->
    <section id="area-section" class="chart-section" style="display: none;">
      <h2>Area Chart</h2>
      <div class="controls">
        <div class="control-group">
          <label for="area-curve">Curve Type</label>
          <select id="area-curve">
            <option value="linear">Linear</option>
            <option value="step">Step</option>
            <option value="cardinal">Cardinal</option>
            <option value="monotone" selected>Monotone</option>
          </select>
        </div>
        <div class="control-group">
          <label for="area-x-name">X Axis Name</label>
          <input type="text" id="area-x-name" value="Date" placeholder="X Axis Name">
        </div>
        <div class="control-group">
          <label for="area-y-name">Y Axis Name</label>
          <input type="text" id="area-y-name" value="Value" placeholder="Y Axis Name">
        </div>
        <div class="control-group">
          <button id="area-toggle-log" class="toggle-button">Toggle Logarithmic</button>
        </div>
        <div class="control-group">
          <button id="area-toggle-stacked" class="toggle-button">Toggle Stacked</button>
        </div>
        <div class="control-group">
          <button id="area-toggle-panel" class="toggle-button">Toggle Panel View</button>
        </div>
        <div class="control-group">
          <button id="area-toggle-recession" class="toggle-button">Toggle Recessions</button>
        </div>
        <div class="control-group">
          <button id="area-toggle-zero" class="toggle-button">Toggle Zero Line</button>
        </div>
      </div>
      <div id="area-chart" class="chart-container"></div>
    </section>
    
    <!-- Bar Chart Section -->
    <section id="bar-section" class="chart-section" style="display: none;">
      <h2>Bar Chart</h2>
      <div class="controls">
        <div class="control-group">
          <label for="bar-width">Bar Width</label>
          <input type="range" id="bar-width" min="0.1" max="1" step="0.1" value="0.7">
        </div>
        <div class="control-group">
          <label for="bar-x-name">X Axis Name</label>
          <input type="text" id="bar-x-name" value="Category" placeholder="X Axis Name">
        </div>
        <div class="control-group">
          <label for="bar-y-name">Y Axis Name</label>
          <input type="text" id="bar-y-name" value="Value" placeholder="Y Axis Name">
        </div>
        <div class="control-group">
          <button id="bar-toggle-log" class="toggle-button">Toggle Logarithmic</button>
        </div>
        <div class="control-group">
          <button id="bar-toggle-group" class="toggle-button active">Toggle Grouped</button>
        </div>
        <div class="control-group">
          <button id="bar-toggle-panel" class="toggle-button">Toggle Panel View</button>
        </div>
        <div class="control-group">
          <button id="bar-toggle-zero" class="toggle-button active">Toggle Zero Line</button>
        </div>
        <div class="control-group">
          <button id="bar-toggle-values" class="toggle-button">Toggle Values</button>
        </div>
      </div>
      <div id="bar-chart" class="chart-container"></div>
    </section>
  </main>
  
  <footer>
    <p>VisionCharts v0.2.0 | MIT License | &copy; 2025 VisionKernel Team</p>
  </footer>
  
  <script type="module">
    // Debug helper function
    function log(message, obj = null) {
      const debugOutput = document.getElementById('debug-output');
      if (debugOutput) {
        debugOutput.style.display = 'block';
        if (obj) {
          debugOutput.innerHTML += `${message}: ${JSON.stringify(obj, null, 2)}\n`;
        } else {
          debugOutput.innerHTML += `${message}\n`;
        }
      }
      console.log(message, obj);
    }
    
    // Error handler helper function
    function handleError(containerId, error) {
      const container = document.getElementById(containerId);
      if (container) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
        
        // Add stack trace in debug mode
        if (debugMode) {
          const stackDiv = document.createElement('div');
          stackDiv.className = 'debug-info';
          stackDiv.textContent = error.stack;
          errorDiv.appendChild(stackDiv);
        }
        
        // Clear container and add error message
        container.innerHTML = '';
        container.appendChild(errorDiv);
      }
      log(`Error in ${containerId}:`, error);
    }
    
    // Debug mode (set to true to enable debugging)
    const debugMode = true;

    // Wait for DOM to be fully loaded
    log('Script started, waiting for DOMContentLoaded');
    
    document.addEventListener('DOMContentLoaded', async function() {
      log('DOM fully loaded');
      
      // Check if chart containers exist
      ['line-chart', 'area-chart', 'bar-chart'].forEach(id => {
        const el = document.getElementById(id);
        log(`Container #${id} exists: ${el !== null}`);
      });
      
      try {
        log('Attempting to import VisionCharts...');
        
        // Dynamically import the library
        let VisionChartsModule;
        try {
          // Try to import from dist directory (production build)
          VisionChartsModule = await import('../dist/visioncharts.esm.js');
          log('Imported from dist/visioncharts.esm.js');
        } catch (e) {
          log('Failed to import from dist, trying src/index.js', e);
          // Fallback to direct import from source (development)
          try {
            VisionChartsModule = await import('../src/index.js');
            log('Imported from src/index.js');
          } catch (e2) {
            log('Failed to import from src/index.js', e2);
            throw new Error('Failed to import VisionCharts library. Check console for details.');
          }
        }
        
        // Destructure needed components
        const { LineChart, AreaChart, BarChart, calculateIndicator } = VisionChartsModule;
        log('Successfully extracted chart components');
        
        // Demo data
        log('Generating sample data...');
        const mockTimeSeriesData = generateTimeSeriesData();
        const multipleDatasets = generateMultipleDatasets();
        const barData = generateBarData();
        
        // US recessions data
        const recessions = [
          { start: new Date('2007-12-01'), end: new Date('2009-06-30') },
          { start: new Date('2020-02-01'), end: new Date('2020-04-30') }
        ];
        
        // Chart instances
        let lineChart;
        let areaChart;
        let barChart;
        
        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const sections = document.querySelectorAll('.chart-section');
        
        log('Setting up tab event listeners');
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            log(`Tab clicked: ${tab.getAttribute('data-tab')}`);
            
            // Deactivate all tabs
            tabs.forEach(t => t.classList.remove('active'));
            
            // Hide all sections
            sections.forEach(s => s.style.display = 'none');
            
            // Activate clicked tab
            tab.classList.add('active');
            
            // Show corresponding section
            const tabName = tab.getAttribute('data-tab');
            const section = document.getElementById(`${tabName}-section`);
            if (section) {
              section.style.display = 'block';
              
              // Initialize chart if not already created
              switch(tabName) {
                case 'line':
                  initLineChart();
                  break;
                case 'area':
                  initAreaChart();
                  break;
                case 'bar':
                  initBarChart();
                  break;
              }
            } else {
              log(`Section not found: ${tabName}-section`);
            }
          });
        });
        
        // Initialize Line Chart
        function initLineChart() {
          log('Initializing Line Chart');
          if (lineChart) {
            log('Line chart already initialized, skipping');
            return;
          }
          
          try {
            const container = document.getElementById('line-chart');
            if (!container) {
              throw new Error('Line chart container not found');
            }
            
            log('Creating LineChart instance');
            lineChart = new LineChart({
              container: '#line-chart',
              data: multipleDatasets,
              options: {
                title: 'Stock Price Comparison',
                xField: 'date',
                yField: 'price',
                xType: 'time',
                yType: 'number',
                xAxisName: 'Date',
                yAxisName: 'Price ($)',
                curve: 'monotone',
                showPoints: false,
                area: false,
                showZeroLine: false,
                showRecessionLines: false,
                recessions: recessions,
                isPanelView: false,
                isLogarithmic: false
              }
            });
            
            log('Rendering line chart');
            lineChart.render();
            
            // Add study for first dataset
            if (multipleDatasets[0] && multipleDatasets[0].data && multipleDatasets[0].data.length > 0) {
              log('Adding SMA study to line chart');
              try {
                const smaData = calculateIndicator('sma', multipleDatasets[0].data, {
                  period: 20,
                  valueField: 'price',
                  xField: 'date'
                });
                
                lineChart.addStudy(multipleDatasets[0].id, {
                  id: 'sma-20',
                  type: 'sma',
                  name: 'SMA (20)',
                  color: '#9C27B0',
                  width: 1.5,
                  params: { period: 20 }
                });
              } catch (studyError) {
                log('Error adding study to line chart', studyError);
              }
            } else {
              log('Cannot add study: no data in first dataset');
            }
            
            // Add event listeners for controls
            log('Adding event listeners for line chart controls');
            
            const lineControls = {
              'line-curve': (e) => {
                log(`Line curve changed to: ${e.target.value}`);
                lineChart.setOptions({ curve: e.target.value });
                lineChart.update();
              },
              'line-x-name': (e) => {
                log(`Line X axis name changed to: ${e.target.value}`);
                lineChart.setXAxisName(e.target.value);
              },
              'line-y-name': (e) => {
                log(`Line Y axis name changed to: ${e.target.value}`);
                lineChart.setYAxisName(e.target.value);
              },
              'line-toggle-log': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Line logarithmic toggled: ${isActive}`);
                lineChart.toggleLogarithmic(isActive);
              },
              'line-toggle-panel': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Line panel view toggled: ${isActive}`);
                lineChart.togglePanelView(isActive);
              },
              'line-toggle-recession': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Line recession lines toggled: ${isActive}`);
                lineChart.toggleRecessionLines(isActive);
              },
              'line-toggle-zero': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Line zero line toggled: ${isActive}`);
                lineChart.toggleZeroLine(isActive);
              },
              'line-toggle-area': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Line area toggled: ${isActive}`);
                lineChart.setOptions({ area: isActive });
                lineChart.update();
              }
            };
            
            // Add all event listeners with error handling
            Object.keys(lineControls).forEach(id => {
              const element = document.getElementById(id);
              if (element) {
                const eventType = element.tagName === 'SELECT' || element.tagName === 'INPUT' && element.type !== 'range' 
                  ? 'change' 
                  : element.type === 'range' ? 'input' : 'click';
                
                element.addEventListener(eventType, e => {
                  try {
                    lineControls[id](e);
                  } catch (controlError) {
                    log(`Error in ${id} control:`, controlError);
                  }
                });
                
                log(`Added ${eventType} event listener to ${id}`);
              } else {
                log(`Element not found: ${id}`);
              }
            });
            
            log('Line chart initialized successfully');
          } catch (error) {
            log('Error initializing line chart:', error);
            handleError('line-chart', error);
          }
        }
        
        // Initialize Area Chart
        function initAreaChart() {
          log('Initializing Area Chart');
          if (areaChart) {
            log('Area chart already initialized, skipping');
            return;
          }
          
          try {
            const container = document.getElementById('area-chart');
            if (!container) {
              throw new Error('Area chart container not found');
            }
            
            log('Creating AreaChart instance');
            areaChart = new AreaChart({
              container: '#area-chart',
              data: multipleDatasets,
              options: {
                title: 'Area Chart Example',
                xField: 'date',
                yField: 'price',
                xType: 'time',
                yType: 'number',
                xAxisName: 'Date',
                yAxisName: 'Value',
                curve: 'monotone',
                showPoints: false,
                area: true,
                stacked: false,
                gradient: true,
                areaOpacity: 0.2,
                showZeroLine: false,
                showRecessionLines: false,
                recessions: recessions,
                isPanelView: false,
                isLogarithmic: false
              }
            });
            
            log('Rendering area chart');
            areaChart.render();
            
            // Add event listeners for controls
            log('Adding event listeners for area chart controls');
            
            const areaControls = {
              'area-curve': (e) => {
                log(`Area curve changed to: ${e.target.value}`);
                areaChart.setOptions({ curve: e.target.value });
                areaChart.update();
              },
              'area-x-name': (e) => {
                log(`Area X axis name changed to: ${e.target.value}`);
                areaChart.setXAxisName(e.target.value);
              },
              'area-y-name': (e) => {
                log(`Area Y axis name changed to: ${e.target.value}`);
                areaChart.setYAxisName(e.target.value);
              },
              'area-toggle-log': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Area logarithmic toggled: ${isActive}`);
                areaChart.toggleLogarithmic(isActive);
              },
              'area-toggle-stacked': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Area stacked toggled: ${isActive}`);
                areaChart.toggleStacked(isActive);
              },
              'area-toggle-panel': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Area panel view toggled: ${isActive}`);
                areaChart.togglePanelView(isActive);
              },
              'area-toggle-recession': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Area recession lines toggled: ${isActive}`);
                areaChart.toggleRecessionLines(isActive);
              },
              'area-toggle-zero': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Area zero line toggled: ${isActive}`);
                areaChart.toggleZeroLine(isActive);
              }
            };
            
            // Add all event listeners with error handling
            Object.keys(areaControls).forEach(id => {
              const element = document.getElementById(id);
              if (element) {
                const eventType = element.tagName === 'SELECT' || element.tagName === 'INPUT' && element.type !== 'range' 
                  ? 'change' 
                  : element.type === 'range' ? 'input' : 'click';
                
                element.addEventListener(eventType, e => {
                  try {
                    areaControls[id](e);
                  } catch (controlError) {
                    log(`Error in ${id} control:`, controlError);
                  }
                });
                
                log(`Added ${eventType} event listener to ${id}`);
              } else {
                log(`Element not found: ${id}`);
              }
            });
            
            log('Area chart initialized successfully');
          } catch (error) {
            log('Error initializing area chart:', error);
            handleError('area-chart', error);
          }
        }
        
        // Initialize Bar Chart
        function initBarChart() {
          log('Initializing Bar Chart');
          if (barChart) {
            log('Bar chart already initialized, skipping');
            return;
          }
          
          try {
            const container = document.getElementById('bar-chart');
            if (!container) {
              throw new Error('Bar chart container not found');
            }
            
            log('Creating BarChart instance');
            barChart = new BarChart({
              container: '#bar-chart',
              data: barData,
              options: {
                title: 'Quarterly Revenue',
                xField: 'category',
                yField: 'value',
                xType: 'category',
                yType: 'number',
                xAxisName: 'Category',
                yAxisName: 'Value',
                barWidth: 0.7,
                barSpacing: 0.2,
                barGap: 0.05,
                groupBars: true,
                showValues: false,
                valuePosition: 'top',
                showZeroLine: true,
                isPanelView: false,
                isLogarithmic: false
              }
            });
            
            log('Rendering bar chart');
            barChart.render();
            
            // Add event listeners for controls
            log('Adding event listeners for bar chart controls');
            
            const barControls = {
              'bar-width': (e) => {
                const value = parseFloat(e.target.value);
                log(`Bar width changed to: ${value}`);
                barChart.setBarWidth(value);
              },
              'bar-x-name': (e) => {
                log(`Bar X axis name changed to: ${e.target.value}`);
                barChart.setXAxisName(e.target.value);
              },
              'bar-y-name': (e) => {
                log(`Bar Y axis name changed to: ${e.target.value}`);
                barChart.setYAxisName(e.target.value);
              },
              'bar-toggle-log': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Bar logarithmic toggled: ${isActive}`);
                barChart.toggleLogarithmic(isActive);
              },
              'bar-toggle-group': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Bar group toggled: ${isActive}`);
                barChart.toggleGroupBars(isActive);
              },
              'bar-toggle-panel': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Bar panel view toggled: ${isActive}`);
                barChart.togglePanelView(isActive);
              },
              'bar-toggle-zero': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Bar zero line toggled: ${isActive}`);
                barChart.toggleZeroLine(isActive);
              },
              'bar-toggle-values': (e) => {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                log(`Bar values toggled: ${isActive}`);
                barChart.toggleShowValues(isActive, 'top');
              }
            };
            
            // Add all event listeners with error handling
            Object.keys(barControls).forEach(id => {
              const element = document.getElementById(id);
              if (element) {
                const eventType = element.tagName === 'SELECT' || element.tagName === 'INPUT' && element.type !== 'range' 
                  ? 'change' 
                  : element.type === 'range' ? 'input' : 'click';
                
                element.addEventListener(eventType, e => {
                  try {
                    barControls[id](e);
                  } catch (controlError) {
                    log(`Error in ${id} control:`, controlError);
                  }
                });
                
                log(`Added ${eventType} event listener to ${id}`);
              } else {
                log(`Element not found: ${id}`);
              }
            });
            
            log('Bar chart initialized successfully');
          } catch (error) {
            log('Error initializing bar chart:', error);
            handleError('bar-chart', error);
          }
        }
        
        // Generate sample time series data
        function generateTimeSeriesData(days = 30, startPrice = 150, volatility = 0.02) {
          const data = [];
          let price = startPrice;
          const today = new Date();
          
          for (let i = 0; i < days; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (days - i));
            
            // Random price movement
            const change = (Math.random() - 0.5) * volatility * price;
            price += change;
            
            data.push({
              date: date,
              price: Math.max(0.1, price)
            });
          }
          
          return data;
        }
        
        // Generate multiple datasets
        function generateMultipleDatasets() {
          const companies = [
            { id: 'company-1', name: 'Company A', color: '#1468a8', startPrice: 100 },
            { id: 'company-2', name: 'Company B', color: '#34A853', startPrice: 80 },
            { id: 'company-3', name: 'Company C', color: '#FBBC05', startPrice: 120 }
          ];
          
          return companies.map(company => ({
            id: company.id,
            name: company.name,
            color: company.color,
            width: 2,
            data: generateTimeSeriesData(60, company.startPrice, 0.02)
          }));
        }
        
        // Generate bar chart data
        function generateBarData() {
          const categories = ['Q1', 'Q2', 'Q3', 'Q4'];
          const companies = [
            { id: 'company-1', name: 'Company A', color: '#1468a8' },
            { id: 'company-2', name: 'Company B', color: '#34A853' },
            { id: 'company-3', name: 'Company C', color: '#FBBC05' }
          ];
          
          return companies.map(company => ({
            id: company.id,
            name: company.name,
            color: company.color,
            data: categories.map(category => ({
              category,
              value: Math.floor(Math.random() * 100) + 20
            }))
          }));
        }
        
        // Initialize line chart on page load
        log('Initializing first chart (line chart)');
        initLineChart();
      } catch (e) {
        log('Fatal error:', e);
        document.body.innerHTML += `
          <div class="error-message" style="margin: 20px;">
            <strong>Fatal Error:</strong> ${e.message}
            ${debugMode ? `<div class="debug-info">${e.stack}</div>` : ''}
          </div>
        `;
      }
    });
  </script>
</body>
</html>